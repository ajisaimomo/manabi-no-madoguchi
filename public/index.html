<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã¾ãªã³ã®çª“å£ ğŸ“šâœ¨</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'BIZ UDPã‚´ã‚·ãƒƒã‚¯', 'Yu Gothic UI', 'Meiryo UI', 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            animation: fadeIn 0.8s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        h1 {
            text-align: center;
            color: #5a67d8;
            font-size: 2.8em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            font-size: 1.2em;
            margin-bottom: 40px;
        }
        
        .section {
            margin-bottom: 50px;
            padding: 30px;
            border-radius: 15px;
            background: linear-gradient(145deg, #f8f9ff 0%, #e8f4f8 100%);
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        
        .section:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .section-title {
            font-size: 1.5em;
            color: #4a5568;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .input-group input[type="text"] {
            flex: 1;
        }
        
        input[type="text"], textarea {
            flex: 1;
            padding: 20px;
            font-size: 18px;
            line-height: 1.8 !important;
            border: 2px solid #cbd5e0;
            border-radius: 10px;
            resize: vertical;
            transition: border-color 0.3s ease;
            font-family: inherit;
            min-height: 150px;
        }
        
        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        textarea {
            resize: vertical;
            min-height: 200px;
            line-height: 1.6;
        }
        
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 20px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
            line-height: 1.8 !important;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn:disabled {
            background: #a0aec0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #48bb78, #38a169);
        }
        
        .btn-danger {
            background: linear-gradient(45deg, #fc8181, #f56565);
        }
        
        .btn-copy {
            background: linear-gradient(45deg, #ed8936, #dd6b20);
        }
        
        .btn-voice {
            background: linear-gradient(45deg, #9f7aea, #805ad5);
            min-width: 50px;
            justify-content: center;
        }
        
        /* ãƒœã‚¿ãƒ³å†…ãƒ«ãƒ“ã®çµ±ä¸€ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆâ‘ ã®å®Ÿè£…ï¼‰ */
        .btn ruby {
            ruby-align: start;
            ruby-position: over;
        }
        
        .btn ruby rt {
            font-size: 0.6em !important;
            color: white !important;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            line-height: 1.2;
            font-weight: 500;
            letter-spacing: 0.5px;
        }
        
        /* å…¨ä½“ã®ãƒ«ãƒ“çµ±ä¸€è¨­å®šï¼ˆæ–‡å­—ãšã‚Œè§£æ¶ˆï¼‰ */
        body, .container, .section, .section-title, .result-box {
            line-height: 2.0 !important;
        }
        
        /* ã™ã¹ã¦ã®rubyã‚¿ã‚°çµ±ä¸€ */
        ruby {
            ruby-align: start;
            ruby-position: over;
            display: inline-ruby;
        }
        
        ruby rt {
            font-size: 0.5em;
            color: #666;
            line-height: 1.0;
            font-weight: normal;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .result-box {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
            min-height: 80px;
            font-size: 18px;
            line-height: 2.4 !important;
            display: none;
        }
        
        .result-success {
            border-color: #68d391;
            background: linear-gradient(145deg, #f0fff4 0%, #c6f6d5 100%);
        }
        
        .result-error {
            border-color: #fc8181;
            background: linear-gradient(145deg, #fffafa 0%, #fed7d7 100%);
            color: #c53030;
        }
        
        .result-loading {
            border-color: #b794f6;
            background: linear-gradient(145deg, #faf5ff 0%, #e9d8fd 100%);
            color: #553c9a;
        }
        
        .stats {
            background: #edf2f7;
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 13px;
            font-family: 'Courier New', monospace;
        }
        
        .copy-success {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #48bb78;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            font-weight: bold;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            animation: copyNotification 4s ease-out;
        }
        
        @keyframes copyNotification {
            0% { opacity: 0; transform: translateX(100px); }
            10% { opacity: 1; transform: translateX(0); }
            90% { opacity: 1; transform: translateX(0); }
            100% { opacity: 0; transform: translateX(100px); }
        }
        
        @media (max-width: 768px) {
            .container { padding: 20px; margin: 10px; }
            h1 { font-size: 2.2em; }
            .input-group { flex-direction: column; }
            .btn { justify-content: center; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ã¾ãªã³ã®çª“å£ ğŸ“šâœ¨</h1>
        <p class="subtitle">Google<ruby>æ¤œç´¢<rt>ã‘ã‚“ã•ã</rt></ruby> + <ruby>è¾æ›¸<rt>ã˜ã—ã‚‡</rt></ruby> + ãƒ«ãƒ“<ruby>æŒ¯<rt>ãµ</rt></ruby>ã‚ŠãŒ1ã¤ã®ã‚µã‚¤ãƒˆã§<ruby>å®Œçµ<rt>ã‹ã‚“ã‘ã¤</rt></ruby></p>
        
        <!-- 1. Googleæ¤œç´¢ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="section">
            <h2 class="section-title">
                <span>ğŸ”</span>
                Google<ruby>æ¤œç´¢<rt>ã‘ã‚“ã•ã</rt></ruby>ï¼ˆ<ruby>éŸ³å£°<rt>ãŠã‚“ã›ã„</rt></ruby><ruby>å…¥åŠ›<rt>ã«ã‚…ã†ã‚Šã‚‡ã</rt></ruby><ruby>å¯¾å¿œ<rt>ãŸã„ãŠã†</rt></ruby>ï¼‰
            </h2>
            <input type="text" id="searchInput" placeholder="èª¿ã¹ãŸã„ã“ã¨ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šäººå·¥çŸ¥èƒ½ã€æ­´å²ã€ç§‘å­¦ãªã©ï¼‰" style="width: 100%; margin-bottom: 15px;">
            <div class="button-group">
                <button class="btn btn-voice" onclick="startVoiceSearch()" id="voiceBtn" title="éŸ³å£°å…¥åŠ›">
                    <ruby>ğŸ¤<rt></rt></ruby> <ruby>éŸ³<rt>ãŠã‚“</rt></ruby><ruby>å£°<rt>ã›ã„</rt></ruby><ruby>å…¥<rt>ã«ã‚…ã†</rt></ruby><ruby>åŠ›<rt>ã‚Šã‚‡ã</rt></ruby>
                </button>
                <button class="btn" onclick="googleSearch()">
                    <ruby>ğŸ”<rt></rt></ruby> <ruby>æ¤œ<rt>ã‘ã‚“</rt></ruby><ruby>ç´¢<rt>ã•ã</rt></ruby>
                </button>
            </div>
            <p style="font-size: 14px; color: #666; margin-top: 10px;">
                ğŸ’¡ <ruby>æ¤œç´¢<rt>ã‘ã‚“ã•ã</rt></ruby><ruby>çµæœ<rt>ã‘ã£ã‹</rt></ruby>ã¯<ruby>æ–°<rt>ã‚ãŸã‚‰</rt></ruby>ã—ã„ã‚¿ãƒ–ã§<ruby>é–‹<rt>ã²ã‚‰</rt></ruby>ãã¾ã™ã€‚<ruby>çµæœ<rt>ã‘ã£ã‹</rt></ruby>ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦<ruby>ä¸‹<rt>ã—ãŸ</rt></ruby>ã®ã€Œãƒ«ãƒ“<ruby>æŒ¯<rt>ãµ</rt></ruby>ã‚Šã€ã§<ruby>ä½¿<rt>ã¤ã‹</rt></ruby>ãˆã¾ã™ã€‚
            </p>
        </div>
        
        <!-- 2. è¾æ›¸ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="section">
            <h2 class="section-title">
                <span>ğŸ“–</span>
                <ruby>å˜èª<rt>ãŸã‚“ã”</rt></ruby>ã®<ruby>æ„å‘³<rt>ã„ã¿</rt></ruby><ruby>èª¿<rt>ã—ã‚‰</rt></ruby>ã¹ï¼ˆ2ã¤ã®<ruby>æ–¹æ³•<rt>ã»ã†ã»ã†</rt></ruby>ï¼‰
            </h2>
            <input type="text" id="dictInput" placeholder="æ„å‘³ã‚’çŸ¥ã‚ŠãŸã„å˜èªã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šäººå·¥çŸ¥èƒ½ã€åäºŒå˜ãªã©ï¼‰" style="width: 100%; margin-bottom: 15px;">
<div class="button-group">
    <button class="btn btn-voice" onclick="startVoiceDict()" id="voiceDictBtn" title="éŸ³å£°å…¥åŠ›">
        <ruby>ğŸ¤<rt></rt></ruby> <ruby>éŸ³<rt>ãŠã‚“</rt></ruby><ruby>å£°<rt>ã›ã„</rt></ruby><ruby>å…¥<rt>ã«ã‚…ã†</rt></ruby><ruby>åŠ›<rt>ã‚Šã‚‡ã</rt></ruby>
    </button>
    <button class="btn" onclick="searchWeblio()">
        <ruby>ğŸ“š<rt></rt></ruby> <ruby>W<rt></rt></ruby><ruby>e<rt></rt></ruby><ruby>b<rt></rt></ruby><ruby>l<rt></rt></ruby><ruby>i<rt></rt></ruby><ruby>o<rt></rt></ruby><ruby>è¾<rt>ã˜</rt></ruby><ruby>æ›¸<rt>ã—ã‚‡</rt></ruby>
    </button>            
<button class="btn" onclick="searchWeblio()" title="Weblioè¾æ›¸ã§èª¿ã¹ã‚‹">
                    <ruby>ğŸ“š<rt></rt></ruby> <ruby>W<rt></rt></ruby><ruby>e<rt></rt></ruby><ruby>b<rt></rt></ruby><ruby>l<rt></rt></ruby><ruby>i<rt></rt></ruby><ruby>o<rt></rt></ruby><ruby>è¾<rt>ã˜</rt></ruby><ruby>æ›¸<rt>ã—ã‚‡</rt></ruby>
                </button>
                <button class="btn btn-secondary" onclick="searchGakken()" title="å­¦ç ”ã‚­ãƒƒã‚ºè¾æ›¸ã§èª¿ã¹ã‚‹">
                    <ruby>ğŸ«<rt></rt></ruby> <ruby>å­¦<rt>ãŒã</rt></ruby><ruby>ç ”<rt>ã‘ã‚“</rt></ruby><ruby>è¾<rt>ã˜</rt></ruby><ruby>æ›¸<rt>ã—ã‚‡</rt></ruby>
                </button>
                <button class="btn btn-danger" onclick="clearDict()">
                    <ruby>ğŸ—‘ï¸<rt></rt></ruby> <ruby>æ¶ˆ<rt>ã—ã‚‡ã†</rt></ruby><ruby>å»<rt>ãã‚‡</rt></ruby>
                </button>
            </div>
            <div id="dictResult" class="result-box"></div>
            <p style="font-size: 14px; color: #666; margin-top: 10px;">
                ğŸ’¡ <strong><ruby>Weblio<rt>ã‚¦ã‚§ãƒ–ãƒªã‚ª</rt></ruby><ruby>è¾æ›¸<rt>ã˜ã—ã‚‡</rt></ruby></strong>ï¼š<ruby>è©³<rt>ãã‚</rt></ruby>ã—ã„<ruby>èª¬æ˜<rt>ã›ã¤ã‚ã„</rt></ruby>ãŒ<ruby>è¦‹<rt>ã¿</rt></ruby>ã¤ã‹ã‚Šã¾ã™ï¼ˆ<ruby>æ–°<rt>ã‚ãŸã‚‰</rt></ruby>ã—ã„ã‚¿ãƒ–ã§<ruby>é–‹<rt>ã²ã‚‰</rt></ruby>ãã¾ã™ï¼‰<br>
                ğŸ’¡ <strong><ruby>å­¦ç ”<rt>ãŒãã‘ã‚“</rt></ruby><ruby>è¾æ›¸<rt>ã˜ã—ã‚‡</rt></ruby></strong>ï¼š<ruby>å­<rt>ã“</rt></ruby>ã©ã‚‚<ruby>å‘<rt>ã‚€</rt></ruby>ã‘ã®<ruby>ã‚„ã•ã—ã„<rt>ã‚„ã•ã—ã„</rt></ruby><ruby>èª¬æ˜<rt>ã›ã¤ã‚ã„</rt></ruby>ï¼ˆ<ruby>æ–°<rt>ã‚ãŸã‚‰</rt></ruby>ã—ã„ã‚¿ãƒ–ã§<ruby>é–‹<rt>ã²ã‚‰</rt></ruby>ãã¾ã™ï¼‰
            </p>
        </div>
        
        <!-- 3. ãƒ«ãƒ“æŒ¯ã‚Šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="section">
            <h2 class="section-title">
                <span>âœ¨</span>
                <ruby>æ–‡ç« <rt>ã¶ã‚“ã—ã‚‡ã†</rt></ruby>ã«ãƒ«ãƒ“<ruby>æŒ¯<rt>ãµ</rt></ruby>ã‚Šï¼ˆWord<ruby>è²¼<rt>ã¯</rt></ruby>ã‚Š<ruby>ä»˜<rt>ã¤</rt></ruby>ã‘<ruby>å¯¾å¿œ<rt>ãŸã„ãŠã†</rt></ruby>ï¼‰
            </h2>
            <textarea id="rubyInput" rows="8" placeholder="ã“ã“ã«æ–‡ç« ã‚’ã‚³ãƒ”ãƒ¼ï¼†ãƒšãƒ¼ã‚¹ãƒˆã—ã¦ãã ã•ã„ã€‚Googleæ¤œç´¢ã®çµæœã€ãƒ‹ãƒ¥ãƒ¼ã‚¹è¨˜äº‹ã€æ•™ç§‘æ›¸ã®å†…å®¹ã€è«–æ–‡ã®ä¸€éƒ¨ãªã©ã€ã©ã‚“ãªæ–‡ç« ã§ã‚‚å¤§ä¸ˆå¤«ã§ã™ã€‚æœ€å¤§2000æ–‡å­—ã¾ã§å‡¦ç†ã§ãã¾ã™ã€‚" style="width: 100%; min-height: 200px; resize: vertical; margin-bottom: 15px;"></textarea>
            <div class="button-group">
                <button class="btn" onclick="addRuby()" id="rubyBtn">
                    <ruby>âœ¨<rt></rt></ruby> <ruby>ãƒ«<rt></rt></ruby><ruby>ãƒ“<rt></rt></ruby><ruby>ã‚’<rt></rt></ruby><ruby>ä»˜<rt>ã¤</rt></ruby><ruby>ã‘<rt></rt></ruby><ruby>ã‚‹<rt></rt></ruby>
                </button>
                <button class="btn btn-danger" onclick="clearRuby()">
                    <ruby>ğŸ—‘ï¸<rt></rt></ruby> <ruby>æ¶ˆ<rt>ã—ã‚‡ã†</rt></ruby><ruby>å»<rt>ãã‚‡</rt></ruby>
                </button>
                <button class="btn btn-copy" onclick="copyResult()" id="copyBtn" style="display: none;">
                    <ruby>ğŸ“‹<rt></rt></ruby> <ruby>çµ<rt>ã‘ã£</rt></ruby><ruby>æœ<rt>ã‹</rt></ruby><ruby>ã‚’<rt></rt></ruby><ruby>ã‚³<rt></rt></ruby><ruby>ãƒ”<rt></rt></ruby><ruby>ãƒ¼<rt></rt></ruby>
                </button>
                <button class="btn btn-secondary" onclick="speakRubyResult()" id="speakBtn" style="display: none;">
                    <ruby>ğŸ”Š<rt></rt></ruby> <ruby>èª­<rt>ã‚ˆ</rt></ruby><ruby>ã¿<rt></rt></ruby><ruby>ä¸Š<rt>ã‚</rt></ruby><ruby>ã’<rt></rt></ruby>
                </button>
                <button class="btn btn-danger" onclick="stopSpeaking()" id="stopBtn" style="display: none;">
                    <ruby>â¹ï¸<rt></rt></ruby> <ruby>åœ<rt>ã¦ã„</rt></ruby><ruby>æ­¢<rt>ã—</rt></ruby>
                </button>
            </div>
            <div id="rubyResult" class="result-box"></div>
        </div>
    </div>

    <!-- ã‚µã‚¤ãƒˆèª¬æ˜ -->
    <div style="margin-top: 60px; padding: 20px; text-align: center; color: #555; font-size: 12px; border-top: 1px solid #e2e8f0;">
        <p style="margin: 0; line-height: 1.6;">
            ã“ã®ã‚µã‚¤ãƒˆã¯ã€è‰²ã€…ãªäº‹æƒ…ã§æ¤œç´¢ã—ãŸã‚Šã€ãã®çµæœã‚’èª­ã‚€ã“ã¨ã«èª²é¡ŒãŒã‚ã‚‹æ–¹ã®ãŸã‚ã«ä½œã‚Šã¾ã—ãŸã€‚<br>
            ã§ãã‚‹ã ã‘å¤šãã®äººãŸã¡ãŒã€è‡ªåˆ†ã®çŸ¥ã‚ŠãŸã„ã“ã¨ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã“ã¨ãŒé¡˜ã„ã§ã™ã€‚
        </p>
    </div>

    <script>
        let currentRubyResult = '';
        let currentDictResult = '';
        
        // éŸ³å£°èªè­˜ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ç®¡ç†ï¼ˆâ‘¡ã®å®Ÿè£…ï¼‰
        let recognition = null;
        let isRecognizing = false;
        
        // ğŸ¯ ç’°å¢ƒã«å¿œã˜ãŸAPI URLè¨­å®šï¼ˆãƒ­ãƒ¼ã‚«ãƒ«/Vercelè‡ªå‹•åˆ¤å®šï¼‰
        const API_BASE = window.location.hostname === 'localhost' 
            ? 'http://localhost:3000'
            : window.location.origin;
        
        console.log(`ğŸŒ API Base URL: ${API_BASE}`);
        
        // éŸ³å£°èªè­˜ã®åˆæœŸåŒ–
        function initVoiceRecognition() {
            if (!recognition) {
                // ãƒ–ãƒ©ã‚¦ã‚¶å¯¾å¿œãƒã‚§ãƒƒã‚¯
                if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                    return false;
                }
                
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                
                recognition.lang = 'ja-JP';
                recognition.continuous = false;
                recognition.interimResults = false;
                
                // ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’ä¸€åº¦ã ã‘è¨­å®š
                recognition.onstart = () => {
                    console.log('ğŸ¤ éŸ³å£°èªè­˜é–‹å§‹');
                    isRecognizing = true;
                    const voiceBtn = document.getElementById('voiceBtn');
                    voiceBtn.style.background = 'linear-gradient(45deg, #fc8181, #f56565)';
                    voiceBtn.innerHTML = '<ruby>ğŸ”´<rt></rt></ruby> <ruby>èª<rt>ã«ã‚“</rt></ruby><ruby>è­˜<rt>ã—ã</rt></ruby><ruby>ä¸­<rt>ã¡ã‚…ã†</rt></ruby>';
                };
                
                recognition.onresult = (event) => {
                    const result = event.results[0][0].transcript;
                    document.getElementById('searchInput').value = result;
                    console.log(`ğŸ¤ éŸ³å£°èªè­˜çµæœ: "${result}"`);
                    
                    // æˆåŠŸé€šçŸ¥
                    showNotification(`ğŸ¤ éŸ³å£°èªè­˜æˆåŠŸ: "${result}"`, 'success');
                };
                
                recognition.onend = () => {
                    console.log('ğŸ¤ éŸ³å£°èªè­˜çµ‚äº†');
                    isRecognizing = false;
                    resetVoiceButton();
                };
                
                recognition.onerror = (event) => {
                    console.error('éŸ³å£°èªè­˜ã‚¨ãƒ©ãƒ¼:', event.error);
                    isRecognizing = false;
                    resetVoiceButton();
                    
                    let errorMessage = '';
                    switch(event.error) {
                        case 'not-allowed':
                            errorMessage = 'ğŸ¤ ãƒã‚¤ã‚¯ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸ\n\nãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼å·¦å´ã®ãƒã‚¤ã‚¯ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€Œè¨±å¯ã€ã‚’é¸æŠã—ã¦ãã ã•ã„';
                            break;
                        case 'no-speech':
                            errorMessage = 'ğŸ¤ éŸ³å£°ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚';
                            break;
                        case 'network':
                            errorMessage = 'ğŸ¤ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';
                            break;
                        default:
                            errorMessage = `ğŸ¤ éŸ³å£°èªè­˜ã‚¨ãƒ©ãƒ¼: ${event.error}`;
                    }
                    
                    alert(errorMessage);
                };
            }
            return true;
        }
        
        // ãƒœã‚¿ãƒ³ã®ãƒªã‚»ãƒƒãƒˆ
        function resetVoiceButton() {
            const voiceBtn = document.getElementById('voiceBtn');
            voiceBtn.style.background = 'linear-gradient(45deg, #9f7aea, #805ad5)';
            voiceBtn.innerHTML = '<ruby>ğŸ¤<rt></rt></ruby> <ruby>éŸ³<rt>ãŠã‚“</rt></ruby><ruby>å£°<rt>ã›ã„</rt></ruby><ruby>å…¥<rt>ã«ã‚…ã†</rt></ruby><ruby>åŠ›<rt>ã‚Šã‚‡ã</rt></ruby>';
        }
        
        // é€šçŸ¥è¡¨ç¤º
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            const bgColor = type === 'success' ? '#48bb78' : type === 'error' ? '#f56565' : '#4299e1';
            
            notification.style.cssText = `
                position: fixed; top: 20px; right: 20px; z-index: 9999;
                background: ${bgColor}; color: white; padding: 15px 20px;
                border-radius: 10px; font-weight: bold;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                max-width: 300px; word-wrap: break-word;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
            }, 3000);
        }
        
        // 1. Googleæ¤œç´¢æ©Ÿèƒ½
        function googleSearch() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) {
                alert('æ¤œç´¢ã—ãŸã„å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            const searchUrl = `https://www.google.com/search?q=${encodeURIComponent(query)}`;
            window.open(searchUrl, '_blank');
            console.log(`ğŸ” Googleæ¤œç´¢: "${query}"`);
        }
        
        // éŸ³å£°å…¥åŠ›æ©Ÿèƒ½ï¼ˆæ”¹è‰¯ç‰ˆ - ã‚°ãƒ­ãƒ¼ãƒãƒ«recognitionä½¿ç”¨ï¼‰
        function startVoiceSearch() {
            if (!initVoiceRecognition()) {
                alert('âŒ ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°èªè­˜ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“\n\nå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶:\nãƒ»Google Chrome\nãƒ»Microsoft Edge\nãƒ»Safariï¼ˆä¸€éƒ¨ï¼‰');
                return;
            }
            
            try {
                if (isRecognizing) {
                    // èªè­˜ä¸­ã®å ´åˆã¯åœæ­¢
                    recognition.stop();
                } else {
                    // å®‰å…¨ãªé–‹å§‹ã®ãŸã‚ã€å‰ã®çŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢
                    if (recognition.state !== 'inactive') {
                        recognition.abort();
                        setTimeout(() => {
                            recognition.start();
                        }, 100);
                    } else {
                        recognition.start();
                    }
                }
            } catch (error) {
                console.error('éŸ³å£°èªè­˜é–‹å§‹ã‚¨ãƒ©ãƒ¼:', error);
                isRecognizing = false;
                resetVoiceButton();
                alert('ğŸ¤ éŸ³å£°èªè­˜ã‚’é–‹å§‹ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ãŒãƒã‚¤ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚');
            }
        }
        
        // Weblioè¾æ›¸ã§æ¤œç´¢
        function searchWeblio() {
            const word = document.getElementById('dictInput').value.trim();
            if (!word) {
                alert('èª¿ã¹ãŸã„å˜èªã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            // Weblioè¾æ›¸ã®æ¤œç´¢URL
            const weblioUrl = `https://www.weblio.jp/content_find?query=${encodeURIComponent(word)}&searchType=exact`;
            window.open(weblioUrl, '_blank');
            
            // å°å­¦ç”Ÿå‘ã‘ã‚ã‹ã‚Šã‚„ã™ã„èª¬æ˜
            const resultDiv = document.getElementById('dictResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result-box result-success';
            resultDiv.innerHTML = `
                <div style="padding: 20px;">
                    <div style="font-size: 1.3em; margin-bottom: 20px; color: #2d3748;">
                        ğŸ“š <ruby>Weblio<rt>ã‚¦ã‚§ãƒ–ãƒªã‚ª</rt></ruby><ruby>è¾æ›¸<rt>ã˜ã—ã‚‡</rt></ruby>ã§ã€Œ${word}ã€ã‚’<ruby>èª¿<rt>ã—ã‚‰</rt></ruby>ã¹ã¦ã„ã¾ã™
                    </div>
                    <div style="background: #e6fffa; padding: 20px; border-radius: 10px; border: 2px solid #4fd1c7; margin-bottom: 20px;">
                        <div style="font-size: 1.1em; font-weight: bold; color: #0d9488; margin-bottom: 15px;">
                            âœ… <ruby>æ–°<rt>ã‚ãŸã‚‰</rt></ruby>ã—ã„ã‚¿ãƒ–ãŒ<ruby>é–‹<rt>ã²ã‚‰</rt></ruby>ãã¾ã—ãŸï¼
                        </div>
                        <div style="font-size: 16px; line-height: 2.2; color: #0f766e;">
                            <ruby>è¾æ›¸<rt>ã˜ã—ã‚‡</rt></ruby>ã®<ruby>ç”»é¢<rt>ãŒã‚ã‚“</rt></ruby>ã§ã€Œ${word}ã€ã®<ruby>æ„å‘³<rt>ã„ã¿</rt></ruby>ã‚’<ruby>è¦‹<rt>ã¿</rt></ruby>ã¤ã‘ã¦ãã ã•ã„ã€‚<br>
                            <ruby>æ„å‘³<rt>ã„ã¿</rt></ruby>ãŒ<ruby>æ›¸<rt>ã‹</rt></ruby>ã„ã¦ã‚ã‚‹<ruby>éƒ¨åˆ†<rt>ã¶ã¶ã‚“</rt></ruby>ã‚’<ruby>é¸<rt>ãˆã‚‰</rt></ruby>ã‚“ã§ã€ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚
                        </div>
                    </div>
                    <div style="background: #fef3c7; padding: 20px; border-radius: 10px; border: 2px solid #f59e0b;">
                        <div style="font-size: 1.1em; font-weight: bold; color: #92400e; margin-bottom: 15px;">
                            ğŸ¯ <ruby>æ¬¡<rt>ã¤ã</rt></ruby>ã«ã‚„ã‚‹ã“ã¨
                        </div>
                        <div style="font-size: 16px; line-height: 2.0; color: #78350f;">
                            <strong>1.</strong> <ruby>è¾æ›¸<rt>ã˜ã—ã‚‡</rt></ruby>ã®<ruby>ç”»é¢<rt>ãŒã‚ã‚“</rt></ruby>ã§<ruby>æ„å‘³<rt>ã„ã¿</rt></ruby>ã‚’ã‚³ãƒ”ãƒ¼<br>
                            <strong>2.</strong> <ruby>ä¸‹<rt>ã—ãŸ</rt></ruby>ã®ã€Œãƒ«ãƒ“<ruby>æŒ¯<rt>ãµ</rt></ruby>ã‚Šã€ã®<ruby>ç®±<rt>ã¯ã“</rt></ruby>ã«<ruby>è²¼<rt>ã¯</rt></ruby>ã‚Š<ruby>ä»˜<rt>ã¤</rt></ruby>ã‘<br>
                            <strong>3.</strong> ã€Œãƒ«ãƒ“ã‚’<ruby>ä»˜<rt>ã¤</rt></ruby>ã‘ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’<ruby>æŠ¼<rt>ãŠ</rt></ruby>ã™
                        </div>
                    </div>
                    <div style="margin-top: 15px; font-size: 14px; color: #666; background: #f0f9ff; padding: 15px; border-radius: 8px;">
                        ğŸ’¡ <ruby>é›£<rt>ã‚€ãšã‹</rt></ruby>ã—ã„<ruby>æ¼¢å­—<rt>ã‹ã‚“ã˜</rt></ruby>ã«ãƒ«ãƒ“ãŒ<ruby>ä»˜<rt>ã¤</rt></ruby>ã„ã¦ã€<ruby>èª­<rt>ã‚ˆ</rt></ruby>ã¿ã‚„ã™ããªã‚Šã¾ã™ï¼
                    </div>
                </div>
            `;
            
            console.log(`ğŸ“š Weblioè¾æ›¸æ¤œç´¢: "${word}"`);
        }
        
        // å­¦ç ”ã‚­ãƒƒã‚ºè¾æ›¸ã§æ¤œç´¢ï¼ˆä¿®æ­£ç‰ˆ - æ­£ã—ã„URLä½¿ç”¨ï¼‰
        function searchGakken() {
            const word = document.getElementById('dictInput').value.trim();
            if (!word) {
                alert('èª¿ã¹ãŸã„å˜èªã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            // HTMLã‹ã‚‰åˆ¤æ˜ã—ãŸæ­£ã—ã„æ¤œç´¢URL
            const gakkenUrl = `https://kids.gakken.co.jp/jiten/result/?s=${encodeURIComponent(word)}`;
            window.open(gakkenUrl, '_blank');
            
            // çµæœè¡¨ç¤º
            const resultDiv = document.getElementById('dictResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result-box result-success';
            resultDiv.innerHTML = `
                <div style="padding: 20px;">
                    <div style="font-size: 1.2em; margin-bottom: 15px; color: #2d3748;">
                        ğŸ« å­¦ç ”ã‚­ãƒƒã‚ºè¾æ›¸ã§ã€Œ${word}ã€ã‚’æ¤œç´¢ä¸­...
                    </div>
                    <div style="background: #e6fffa; padding: 15px; border-radius: 8px; border: 1px solid #4fd1c7;">
                        <strong>âœ… æ¤œç´¢ãŒé–‹å§‹ã•ã‚Œã¾ã—ãŸï¼</strong><br>
                        æ–°ã—ã„ã‚¿ãƒ–ã§å­¦ç ”ã‚­ãƒƒã‚ºè¾æ›¸ã®æ¤œç´¢çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚<br>
                        å­ã©ã‚‚å‘ã‘ã®åˆ†ã‹ã‚Šã‚„ã™ã„èª¬æ˜ãŒè¦‹ã¤ã‹ã‚Šã¾ã™ã€‚
                    </div>
                    <div style="margin-top: 15px; font-size: 14px; color: #666;">
                        ğŸ’¡ æ¤œç´¢çµæœãŒè¡¨ç¤ºã•ã‚Œãªã„å ´åˆã¯ã€æ¤œç´¢çª“ã«ã€Œ${word}ã€ã¨å†å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
                    </div>
                </div>
            `;
            
            console.log(`ğŸ« å­¦ç ”è¾æ›¸ã§æ­£ã—ã„æ¤œç´¢URLä½¿ç”¨: "${word}"`);
        }
        
        // è¾æ›¸ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ¶ˆå»
        function clearDict() {
            document.getElementById('dictInput').value = '';
            document.getElementById('dictResult').style.display = 'none';
            currentDictResult = '';
            console.log('ğŸ—‘ï¸ è¾æ›¸ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ¶ˆå»');
        }
        
        // ğŸ¯ ãƒ«ãƒ“æŒ¯ã‚Šæ©Ÿèƒ½ï¼ˆVercelå¯¾å¿œç‰ˆ - ç’°å¢ƒè‡ªå‹•åˆ¤å®šï¼‰
        async function addRuby() {
            const text = document.getElementById('rubyInput').value.trim();
            if (!text) {
                alert('ãƒ«ãƒ“ã‚’æŒ¯ã‚ŠãŸã„æ–‡ç« ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            if (text.length > 2000) {
                alert('æ–‡ç« ãŒé•·ã™ãã¾ã™ã€‚2000æ–‡å­—ä»¥å†…ã«ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            const resultDiv = document.getElementById('rubyResult');
            const rubyBtn = document.getElementById('rubyBtn');
            const copyBtn = document.getElementById('copyBtn');
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result-box result-loading';
            resultDiv.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 1.5em; margin-bottom: 10px;">âš¡</div>
                    <div>kuromoji.js ã§ãƒ«ãƒ“ã‚’æŒ¯ã£ã¦ã„ã¾ã™...</div>
                    <div style="font-size: 14px; color: #666; margin-top: 5px;">
                        ${API_BASE === window.location.origin ? 'Vercel' : 'ãƒ­ãƒ¼ã‚«ãƒ«'}ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šã‚’ç¢ºèªä¸­...
                    </div>
                </div>
            `;
            rubyBtn.disabled = true;
            copyBtn.style.display = 'none';
            
            try {
                console.log(`ğŸŒ APIå‘¼ã³å‡ºã—: ${API_BASE}/api/ruby-yahoo`);
                
                // ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šç¢ºèª
                let response;
                try {
                    response = await fetch(`${API_BASE}/api/ruby-yahoo`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ text: text })
                    });
                } catch (fetchError) {
                    console.error('ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šã‚¨ãƒ©ãƒ¼:', fetchError);
                    
                    if (API_BASE === window.location.origin) {
                        // Vercelç’°å¢ƒã§ã®æ¥ç¶šã‚¨ãƒ©ãƒ¼
                        throw new Error(`Vercelã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“ã€‚

è€ƒãˆã‚‰ã‚Œã‚‹åŸå› :
1. Vercel FunctionsãŒã¾ã åˆæœŸåŒ–ä¸­ã§ã™
2. ä¸€æ™‚çš„ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã§ã™
3. APIé–¢æ•°ãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã¾ã›ã‚“

è§£æ±ºæ–¹æ³•:
ãƒ»å°‘ã—å¾…ã£ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„
ãƒ»ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„

ã‚¨ãƒ©ãƒ¼è©³ç´°: ${fetchError.message}`);
                    } else {
                        // ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®æ¥ç¶šã‚¨ãƒ©ãƒ¼
                        throw new Error(`ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“ã€‚

è§£æ±ºæ–¹æ³•:
1. ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ 'npm start' ã‚’å®Ÿè¡Œ
2. ã‚µãƒ¼ãƒãƒ¼ãŒ http://localhost:3000 ã§èµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
3. ãƒ–ãƒ©ã‚¦ã‚¶ã‚’å†èª­ã¿è¾¼ã¿

ã‚¨ãƒ©ãƒ¼è©³ç´°: ${fetchError.message}`);
                    }
                }
                
                if (!response.ok) {
                    const errorText = await response.text().catch(() => 'ãƒ¬ã‚¹ãƒãƒ³ã‚¹å–å¾—å¤±æ•—');
                    throw new Error(`ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼: ${response.status} ${response.statusText}\nè©³ç´°: ${errorText}`);
                }
                
                let data;
                try {
                    data = await response.json();
                } catch (jsonError) {
                    throw new Error('ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®å¿œç­”ãŒä¸æ­£ã§ã™ã€‚JSONè§£æã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
                }
                
                if (data.success) {
                    currentRubyResult = data.rubyText;
                    
                    resultDiv.className = 'result-box result-success';
                    resultDiv.innerHTML = `
                        <div style="font-weight: bold; margin-bottom: 15px; color: #2d3748;">
                            âœ¨ ãƒ«ãƒ“æŒ¯ã‚Šå®Œäº†ï¼
                        </div>
                        <div style="padding: 20px; background: #fff; border-radius: 10px; border: 2px solid #e2e8f0; line-height: 2.2;">
                            ${data.rubyText}
                        </div>
                        <div class="stats">
                            ğŸ“Š ${text.length}æ–‡å­— â†’ ${data.tokenCount}ãƒˆãƒ¼ã‚¯ãƒ³å‡¦ç†å®Œäº† (${data.processingTime || 50}ms) | ${API_BASE === window.location.origin ? 'Vercel' : 'ãƒ­ãƒ¼ã‚«ãƒ«'}ã‚µãƒ¼ãƒãƒ¼
                        </div>
                    `;
                    
                    copyBtn.style.display = 'flex';
                    document.getElementById('speakBtn').style.display = 'flex';
                    document.getElementById('stopBtn').style.display = 'flex';
                    console.log(`âœ¨ ãƒ«ãƒ“æŒ¯ã‚Šå®Œäº†: ${data.tokenCount}ãƒˆãƒ¼ã‚¯ãƒ³`);
                } else {
                    throw new Error(data.error || 'ãƒ«ãƒ“æŒ¯ã‚Šå‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
                }
                
            } catch (error) {
                console.error('ãƒ«ãƒ“æŒ¯ã‚Šã‚¨ãƒ©ãƒ¼:', error);
                resultDiv.className = 'result-box result-error';
                resultDiv.innerHTML = `
                    <div style="padding: 20px;">
                        <div style="font-size: 1.2em; margin-bottom: 15px; color: #c53030;">
                            âŒ ãƒ«ãƒ“æŒ¯ã‚Šã‚¨ãƒ©ãƒ¼
                        </div>
                        <div style="background: #fed7d7; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <strong>ã‚¨ãƒ©ãƒ¼å†…å®¹:</strong><br>
                            ${error.message}
                        </div>
                        <div style="background: #e6fffa; padding: 15px; border-radius: 8px;">
                            <strong>ğŸ’¡ è§£æ±ºæ–¹æ³•:</strong><br>
                            ${API_BASE === window.location.origin 
                                ? 'ãƒ»Vercelãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„<br>ãƒ»å°‘ã—æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„' 
                                : '1. ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ <code>npm start</code> ã‚’å®Ÿè¡Œ<br>2. ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ãŸã‚‰ãƒ–ãƒ©ã‚¦ã‚¶ã‚’å†èª­ã¿è¾¼ã¿<br>3. ã“ã®ç”»é¢ã§ã€Œãƒ«ãƒ“ã‚’ä»˜ã‘ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’å†åº¦æŠ¼ã™'}
                        </div>
                    </div>
                `;
            } finally {
                rubyBtn.disabled = false;
            }
        }
        
        // ãƒ«ãƒ“ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ¶ˆå»
        function clearRuby() {
            document.getElementById('rubyInput').value = '';
            document.getElementById('rubyResult').style.display = 'none';
            document.getElementById('copyBtn').style.display = 'none';
            document.getElementById('speakBtn').style.display = 'none';
            document.getElementById('stopBtn').style.display = 'none';
            currentRubyResult = '';
            
            // èª­ã¿ä¸Šã’ã‚’åœæ­¢
            if ('speechSynthesis' in window) {
                speechSynthesis.cancel();
            }
            
            console.log('ğŸ—‘ï¸ ãƒ«ãƒ“ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ¶ˆå»');
        }
        
        // ãƒ«ãƒ“æŒ¯ã‚Šçµæœã®èª­ã¿ä¸Šã’æ©Ÿèƒ½
        function speakRubyResult() {
            if (!currentRubyResult) {
                alert('èª­ã¿ä¸Šã’ã‚‹å†…å®¹ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            if (!('speechSynthesis' in window)) {
                alert('ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°èª­ã¿ä¸Šã’ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“');
                return;
            }
            
            // HTMLã‚¿ã‚°ã‚’é™¤å»ã—ã¦ãƒ†ã‚­ã‚¹ãƒˆã®ã¿æŠ½å‡º
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = currentRubyResult;
            const textToSpeak = tempDiv.textContent || tempDiv.innerText || '';
            
            if (!textToSpeak.trim()) {
                alert('èª­ã¿ä¸Šã’ã‚‹æ–‡ç« ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            // æ—¢å­˜ã®èª­ã¿ä¸Šã’ã‚’åœæ­¢
            speechSynthesis.cancel();
            
            // èª­ã¿ä¸Šã’è¨­å®š
            const utterance = new SpeechSynthesisUtterance(textToSpeak);
            utterance.lang = 'ja-JP';
            utterance.rate = 0.8;  // å°‘ã—ã‚†ã£ãã‚Š
            utterance.pitch = 1.1; // å°‘ã—é«˜ã‚ã®å£°
            utterance.volume = 0.9;
            
            // èª­ã¿ä¸Šã’çŠ¶æ…‹ã®è¡¨ç¤º
            const speakBtn = document.getElementById('speakBtn');
            const stopBtn = document.getElementById('stopBtn');
            
            utterance.onstart = () => {
                speakBtn.style.background = 'linear-gradient(45deg, #fc8181, #f56565)';
                speakBtn.innerHTML = '<ruby>ğŸ”Š<rt></rt></ruby> <ruby>èª­<rt>ã‚ˆ</rt></ruby><ruby>ã¿<rt></rt></ruby><ruby>ä¸Š<rt>ã‚</rt></ruby><ruby>ã’<rt></rt></ruby><ruby>ä¸­<rt>ã¡ã‚…ã†</rt></ruby>';
                stopBtn.style.display = 'flex';
                console.log('ğŸ”Š èª­ã¿ä¸Šã’é–‹å§‹');
                
                // èª­ã¿ä¸Šã’ä¸­ã®é€šçŸ¥
                showNotification('ğŸ”Š èª­ã¿ä¸Šã’ã¦ã„ã¾ã™...', 'info');
            };
            
            utterance.onend = () => {
                speakBtn.style.background = 'linear-gradient(45deg, #48bb78, #38a169)';
                speakBtn.innerHTML = '<ruby>ğŸ”Š<rt></rt></ruby> <ruby>èª­<rt>ã‚ˆ</rt></ruby><ruby>ã¿<rt></rt></ruby><ruby>ä¸Š<rt>ã‚</rt></ruby><ruby>ã’<rt></rt></ruby>';
                console.log('ğŸ”Š èª­ã¿ä¸Šã’å®Œäº†');
                
                // å®Œäº†é€šçŸ¥
                showNotification('âœ… èª­ã¿ä¸Šã’ãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');
            };
            
            utterance.onerror = (event) => {
                console.error('èª­ã¿ä¸Šã’ã‚¨ãƒ©ãƒ¼:', event.error);
                speakBtn.style.background = 'linear-gradient(45deg, #48bb78, #38a169)';
                speakBtn.innerHTML = '<ruby>ğŸ”Š<rt></rt></ruby> <ruby>èª­<rt>ã‚ˆ</rt></ruby><ruby>ã¿<rt></rt></ruby><ruby>ä¸Š<rt>ã‚</rt></ruby><ruby>ã’<rt></rt></ruby>';
                
                showNotification('âŒ èª­ã¿ä¸Šã’ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
            };
            
            // èª­ã¿ä¸Šã’é–‹å§‹
            speechSynthesis.speak(utterance);
        }
        
        // èª­ã¿ä¸Šã’åœæ­¢æ©Ÿèƒ½
        function stopSpeaking() {
            if ('speechSynthesis' in window) {
                speechSynthesis.cancel();
                
                // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
                const speakBtn = document.getElementById('speakBtn');
                speakBtn.style.background = 'linear-gradient(45deg, #48bb78, #38a169)';
                speakBtn.innerHTML = '<ruby>ğŸ”Š<rt></rt></ruby> <ruby>èª­<rt>ã‚ˆ</rt></ruby><ruby>ã¿<rt></rt></ruby><ruby>ä¸Š<rt>ã‚</rt></ruby><ruby>ã’<rt></rt></ruby>';
                
                console.log('â¹ï¸ èª­ã¿ä¸Šã’åœæ­¢');
                showNotification('â¹ï¸ èª­ã¿ä¸Šã’ã‚’åœæ­¢ã—ã¾ã—ãŸ', 'info');
            }
        }
        
        // çµæœã‚’ã‚³ãƒ”ãƒ¼ï¼ˆWordè²¼ã‚Šä»˜ã‘å¯¾å¿œãƒ»ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºèª¿æ•´ç‰ˆï¼‰
        function copyResult() {
            if (!currentRubyResult) {
                alert('ã‚³ãƒ”ãƒ¼ã™ã‚‹çµæœãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            try {
                // Wordç”¨ã«æœ€é©åŒ–ã•ã‚ŒãŸHTMLã‚’ç”Ÿæˆï¼ˆUDãƒ•ã‚©ãƒ³ãƒˆ + æ–‡å­—16pxã€ãƒ«ãƒ“8pxï¼‰
                const optimizedHTML = `
                    <div style="font-family: 'BIZ UDPã‚´ã‚·ãƒƒã‚¯', 'Yu Gothic UI', 'Meiryo UI', 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', sans-serif; font-size: 16px; line-height: 2.2;">
                        ${currentRubyResult.replace(/<ruby>/g, '<ruby style="font-size: 16px;">').replace(/<rt>/g, '<rt style="font-size: 8px; color: #666;">')}
                    </div>
                `;
                
                // ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç‰ˆï¼ˆãƒ«ãƒ“ãªã—ï¼‰
                const plainText = currentRubyResult.replace(/<[^>]*>/g, '');
                
                // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰APIã‚’ä½¿ç”¨ï¼ˆHTMLã¨ãƒ†ã‚­ã‚¹ãƒˆä¸¡æ–¹ã‚’ã‚³ãƒ”ãƒ¼ï¼‰
                if (navigator.clipboard && navigator.clipboard.write) {
                    const clipboardItem = new ClipboardItem({
                        'text/html': new Blob([optimizedHTML], { type: 'text/html' }),
                        'text/plain': new Blob([plainText], { type: 'text/plain' })
                    });
                    
                    navigator.clipboard.write([clipboardItem]).then(() => {
                        showCopySuccess('Wordæœ€é©åŒ–ç‰ˆ');
                        console.log('ğŸ“‹ Wordæœ€é©åŒ–HTML + ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼å®Œäº†');
                    }).catch(err => {
                        console.log('HTML+ãƒ†ã‚­ã‚¹ãƒˆã‚³ãƒ”ãƒ¼å¤±æ•—ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè¡Œ');
                        fallbackCopy();
                    });
                } else {
                    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ãƒ†ã‚­ã‚¹ãƒˆã®ã¿ã‚³ãƒ”ãƒ¼
                    fallbackCopy();
                }
                
            } catch (error) {
                console.error('ã‚³ãƒ”ãƒ¼ã‚¨ãƒ©ãƒ¼:', error);
                alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }
        
        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ãƒ†ã‚­ã‚¹ãƒˆã®ã¿ã‚³ãƒ”ãƒ¼
        function fallbackCopy() {
            const textArea = document.createElement('textarea');
            textArea.value = currentRubyResult.replace(/<[^>]*>/g, ''); // HTMLã‚¿ã‚°ã‚’é™¤å»
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            showCopySuccess('ãƒ†ã‚­ã‚¹ãƒˆç‰ˆ');
            console.log('ğŸ“‹ ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼å®Œäº†ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰');
        }
        
        // ã‚³ãƒ”ãƒ¼æˆåŠŸé€šçŸ¥ï¼ˆè©³ç´°ç‰ˆï¼‰
        function showCopySuccess(type) {
            const notification = document.createElement('div');
            notification.className = 'copy-success';
            notification.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 5px;">ğŸ“‹ ã‚³ãƒ”ãƒ¼å®Œäº†ï¼</div>
                <div style="font-size: 13px;">
                    ${type}ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ<br>
                    Wordã«è²¼ã‚Šä»˜ã‘ã‚‹ã¨æ–‡å­—16pxã€ãƒ«ãƒ“8pxã§è¡¨ç¤ºã•ã‚Œã¾ã™
                </div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
            }, 4000);
        }
        
        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case 'Enter':
                        if (document.activeElement.id === 'searchInput') {
                            e.preventDefault();
                            googleSearch();
                        } else if (document.activeElement.id === 'dictInput') {
                            e.preventDefault();
                            searchWeblio();
                        } else if (document.activeElement.id === 'rubyInput') {
                            e.preventDefault();
                            addRuby();
                        }
                        break;
                    case 'c':
                        if (currentRubyResult && document.activeElement.id === 'rubyInput') {
                            e.preventDefault();
                            copyResult();
                        }
                        break;
                }
            }
        });
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†æ™‚
        window.addEventListener('load', () => {
            console.log('ğŸ“š ã¾ãªã³ã®çª“å£ - æº–å‚™å®Œäº†ï¼');
            console.log(`ğŸŒ å‹•ä½œç’°å¢ƒ: ${API_BASE === window.location.origin ? 'Vercelæœ¬ç•ª' : 'ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º'}`);
            console.log(`ğŸ”Œ APIæ¥ç¶šå…ˆ: ${API_BASE}/api/ruby-yahoo`);
            console.log('âŒ¨ï¸  ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ: Ctrl+Enter=å®Ÿè¡Œ, Ctrl+C=ã‚³ãƒ”ãƒ¼');
            console.log('âœ¨ æ”¹è‰¯ç‰ˆ: â‘ ãƒœã‚¿ãƒ³ãƒ«ãƒ“çµ±ä¸€ â‘¡éŸ³å£°èªè­˜ã‚°ãƒ­ãƒ¼ãƒãƒ«ç®¡ç† â‘¢Vercelå¯¾å¿œ');
            
            // æœ€åˆã®å…¥åŠ›æ¬„ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
            document.getElementById('searchInput').focus();
        });
    </script>
</body>
</html>